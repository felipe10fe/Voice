<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>voice</title>
        <script src="https://brazilrp.herokuapp.com/dist/RTCMultiConnection.min.js"></script>
        <script src="https://brazilrp.herokuapp.com/dist/getHTMLMediaElement.js"></script>
        <script src="https://brazilrp.herokuapp.com/dist/socket.io.js"></script>
    </head>
    <body>
        <div id="audios_container"></div>
        <div id="talking_info"></div>
        <script>
        	let connection = new RTCMultiConnection();
            let mystream = null;
            let pressingpushtotalk = false;

			connection.socketURL = "https://brazilrp.herokuapp.com:443/";

			connection.socketMessageEvent = 'voice';
			connection.leaveOnPageUnload = false;

			connection.session = {
			    audio: true,
			    video: false
			};

			connection.mediaConstraints = {
			    audio: true,
			    video: false
			};

			connection.sdpConstraints.mandatory = {
			    OfferToReceiveAudio: true,
			    OfferToReceiveVideo: false
            };

            connection.extra = {
                username: "",
				room: "roleplay"
            }

			connection.audiosContainer = document.getElementById( "audios_container" );

			connection.onstream = function ( event ) {
                event.mediaElement.id = event.extra.username;

			    if ( event.type == "local" ) {
			    	mystream = event.stream;
			    	event.stream.mute ( "audio" );
			    }
			};

            connection.onmute = function ( event ) {
            }

            connection.onunmute = function ( event ) {
            }

            function joinRoom () {
			connection.openOrJoin( connection.extra.room );
            }
			
			function SetOtherPlayerLevel ( other_player , volume ) {
				connection.onUserStatusChanged({
					userid: other_player,
					volume: volume
				});
			}

            document.onkeydown = function ( event ) {
                if ( !pressingpushtotalk ) {
                    if ( mystream != null && event.keyCode == 0x4E ) { // N
                        pressingpushtotalk = true;
                        mystream.unmute( "audio" );
                    }
                }
			};

            document.onkeyup = function ( event ) {
                if ( pressingpushtotalk ) {
                    if ( mystream != null && event.keyCode == 0x4E ) {  // N
                        pressingpushtotalk = false;
                        mystream.mute( "audio" );
                    }
                }
            };
		</script>
    </body>
</html>
