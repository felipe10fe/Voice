<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>voice</title>
        <script src="https://brazilrp.herokuapp.com/dist/RTCMultiConnection.min.js"></script>
        <script src="https://brazilrp.herokuapp.com/dist/getHTMLMediaElement.js"></script>
        <script src="https://brazilrp.herokuapp.com/dist/socket.io.js"></script>
        <style>
            #talking_info {
                position: absolute;
                top: 48%;
                left: 1%;
                font-size: 1.0em;
                overflow: hidden;
                max-height: 52%;
                color: #fff;
                text-shadow: 1px 0 0 #000, 0 -1px 0 #000, 0 1px 0 #000, -1px 0 0 #000;
            }

            .talking_name {
                position: relative;
            }
        </style>
    </head>
    <body>
        <div id="audios_container"></div>
        <div id="talking_info"></div>
        <script>
            let talkinginfo = document.getElementById( "talking_info" );
        	let connection = new RTCMultiConnection();
            let mystream = null;
            let pressingpushtotalk = false;
            let alreadyjoined = false;

			connection.socketURL = "https://brazilrp.herokuapp.com:443/";

			connection.socketMessageEvent = 'voice';
			connection.leaveOnPageUnload = false;

			connection.session = {
			    audio: true,
			    video: false
			};

			connection.mediaConstraints = {
			    audio: true,
			    video: false
			};

			connection.sdpConstraints.mandatory = {
			    OfferToReceiveAudio: true,
			    OfferToReceiveVideo: false
            };

            connection.extra = {
                username: ""
            }
			connection.join ( 'roleplay' );
			connection.audiosContainer = document.getElementById( "audios_container" );

			connection.onstream = function ( event ) {
			    if ( event.type == "local" ) {
			    	mystream = event.stream;
			    	event.stream.mute ( "audio" );
			    }
			};

            document.onkeydown = function ( event ) {
                if ( !pressingpushtotalk ) {
                    if ( mystream != null && event.keyCode == 0x4E ) { // N
                        pressingpushtotalk = true;
                        mystream.unmute( "audio" );
                    }
                }
			};

            document.onkeyup = function ( event ) {
                if ( pressingpushtotalk ) {
                    if ( mystream != null && event.keyCode == 0x4E ) {  // N
                        pressingpushtotalk = false;
                        mystream.mute( "audio" );
                    }
                }
            };
		</script>
    </body>
</html>
